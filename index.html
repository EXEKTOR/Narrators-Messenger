<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Narrators Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        input { padding: 10px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <h1>Тест Firebase</h1>
    
    <div id="auth">
        <input id="email" type="email" placeholder="Email">
        <input id="password" type="password" placeholder="Пароль">
        <br>
        <button id="loginBtn">Войти</button>
        <button id="registerBtn">Регистрация</button>
        <button id="googleBtn">Google</button>
    </div>
    
    <div id="app" style="display:none;">
        <h2>Вы вошли!</h2>
        <button id="logoutBtn">Выйти</button>
    </div>
    
    <div id="error" style="color:red; margin-top:20px;"></div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    
    <script>
        // Конфиг из вашего проекта
        const firebaseConfig = {
            apiKey: "AIzaSyBcrCVxPPU_PVOeFFBJ8sKXehMZyKaB4ks",
            authDomain: "narrators-messenger.firebaseapp.com",
            databaseURL: "https://narrators-messenger-default-rtdb.firebaseio.com",
            projectId: "narrators-messenger",
            storageBucket: "narrators-messenger.firebasestorage.app",
            messagingSenderId: "421115209686",
            appId: "1:421115209686:web:94d5560793540f14f02677"
        };
        
        // Инициализация
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        console.log("Firebase инициализирован");
        
        // Кнопки
        document.getElementById('loginBtn').onclick = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showMessage("Вход успешен!");
            } catch (error) {
                showError("Ошибка входа: " + error.message);
            }
        };
        
        document.getElementById('registerBtn').onclick = async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const result = await auth.createUserWithEmailAndPassword(email, password);
                
                // Создаем профиль в базе
                await db.ref('users/' + result.user.uid).set({
                    email: email,
                    createdAt: Date.now()
                });
                
                showMessage("Регистрация успешна!");
            } catch (error) {
                showError("Ошибка регистрации: " + error.message);
            }
        };
        
        document.getElementById('googleBtn').onclick = async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            try {
                await auth.signInWithPopup(provider);
                showMessage("Google вход успешен!");
            } catch (error) {
                showError("Ошибка Google: " + error.message);
            }
        };
        
        document.getElementById('logoutBtn').onclick = () => {
            auth.signOut();
        };
        
        // Слушатель авторизации
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                console.log("Пользователь:", user.email);
            } else {
                document.getElementById('auth').style.display = 'block';
                document.getElementById('app').style.display = 'none';
                console.log("Пользователь вышел");
            }
        });
        
        function showError(msg) {
            document.getElementById('error').textContent = msg;
        }
        
        function showMessage(msg) {
            document.getElementById('error').style.color = 'green';
            document.getElementById('error').textContent = msg;
            setTimeout(() => {
                document.getElementById('error').style.color = 'red';
                document.getElementById('error').textContent = '';
            }, 3000);
        }
    </script>
</body>
</html>
